<!DOCTYPE html>
<html lang="en">
<head>
	<title>Cart</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/themify/themify-icons.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/elegant-font/html-css/style.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/slick/slick.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->

<script src="https://js.stripe.com/v3/"></script>

</head>
<body class="animsition" onload= loadAllFunctions()>
	

	<!-- top noti -->
	<div class="flex-c-m size22 bg0 s-text21 pos-relative">
			Point to Point Communication
	</div>

	<!-- Header -->
	<header class="header1">
		

			<div class="wrap_header">
				<!-- Logo -->
				<a href="index.html" class="logo">
					<img src="images/icons/logo.png" alt="IMG-LOGO">
				</a>

				<!-- Menu -->
				<div class="wrap_menu">
					<nav class="menu">
						<ul class="main_menu">
							<li>
								<a href="index.html">Home</a>
							</li>

							<li>
								<a href="product.html">Shop</a>
							</li>


							<li>
								<a href="about.html">About</a>
							</li>

							<li>
								<a href="contact.html">Contact</a>
							</li>
							<li>
									<a href="companies.html">Corporate</a>
								</li>


						</ul>
					</nav>
				</div>

				<!-- Header Icon -->
				<div class="header-icons">
						<span class="topbar-id"></span>
					<a href="#" class="header-wrapicon1 dis-block">
						<img src="images/icons/icon-header-01.png" class="header-icon1" alt="ICON">
					</a>

					<span class="linedivide1"></span>

					<div class="header-wrapicon2">
						<img src="images/icons/icon-header-02.png" class="header-icon1 js-show-header-dropdown" alt="ICON">
						<span class="header-icons-noti" id="counter"></span>

						<script>
						var number = sessionStorage.getItem("item");
						var cart = JSON.parse(sessionStorage.getItem(number)); //edit promotion to allow cart to take the place of items added to cart
						//console.log(cart);
						//var counter = cart.length; //counter = number of items in cart
						document.getElementById("counter").innerHTML = "1";
						</script>

						<!-- Header cart noti -->
						<div class="header-cart header-dropdown">
							<ul class="header-cart-wrapitem">
								<li class = "insert-header">

								</li>

								
							</ul>

							<div class="header-cart-total">
								<!-- Total: $<p id="header_total"></p>  -->
								<span id="total_price"></span>
							</div>

							<script>	
								console.log(total_price);
							</script>
							<div class="header-cart-buttons">
								<div class="header-cart-wrapbtn">
									<!-- Button -->
									<a href="cart.html" class="flex-c-m size1 bg1 bo-rad-20 hov1 s-text1 trans-0-4">
										View Cart
									</a>
								</div>

								<div class="header-cart-wrapbtn">
									<!-- Button -->
									<a href="#" class="flex-c-m size1 bg1 bo-rad-20 hov1 s-text1 trans-0-4">
										Check Out
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		
	</header>

	<!-- Title Page -->
	<section class="bg-title-page p-t-40 p-b-50 flex-col-c-m" style="background-image: url(images/heading-pages-01.jpg);">
		<h2 class="l-text2 t-center" >
			<font color="black"> Cart </font>
		</h2>
	</section>

	<!-- Cart -->
	<section class="cart bgwhite p-t-70 p-b-100">
		<div class="container">
			<!-- Cart item -->
			<div class="container-table-cart pos-relative">
				<div class="wrap-table-shopping-cart bgwhite">
					<table class="table-shopping-cart">
						<tr class="table-head">
							<th class="column-1"></th>
							<th class="column-2">Product</th>
							<th class="column-3">Price</th>
							<th class="column-4">Quantity</th>
							<th class="column-4">Total</th>
							<tr class ="insert-item">


							</tr>
						</tr>
						
						
						
						</tr>
					</table>
				</div>
			</div>

			

			<!-- Total -->
			<div class="bo9 w-size18 p-l-40 p-r-40 p-t-30 p-b-38 m-t-30 m-r-0 m-l-auto p-lr-15-sm">
				<h5 class="m-text20 p-b-24">
					Cart Total
				</h5>

				<!--  -->
				<div class="flex-w flex-sb-m p-b-12">
					<span class="s-text18 w-size19 w-full-sm" id="subtotal">
						
					</span>

						<span class="m-text21 w-size20 w-full-sm" id="subtotal">
						<!-- id="subtotal" links to javascript where var total_price will be input here-->
					</span>
				</div>
				
				
				

				<!--  -->
				<div class="flex-w flex-sb bo10 p-t-15 p-b-20">
					<span class="s-text18 w-size19 w-full-sm">
						Shipping:
					</span>

					<div class="w-size20 w-full-sm">
						<p class="s-text8 p-b-23">
							
						</p>

						<span class="s-text19">
							Calculate Shipping
						</span>

						<form id="shipping">
                                <div class="rs2-select2 rs3-select2 rs4-select2 bo4 of-hidden w-size9 m-t-10 m-b-12">
                                        <select name="shipping" id='ship' class="select_shipping">
                                        <option>Select a shipping option</option>
                                        
                                            
                                        </select>
                                </div>
                
                                <div class="size14 trans-0-4 m-b-10">
                                        <!-- Button -->
                                        
                                        <button class="flex-c-m sizefull bg1 bo-rad-23 hov1 s-text1 trans-0-4" id="submit" type="button">Calculate Price</button>
                                </div>  
                        </form>
					</div>
				</div>

				<!--  -->
				<div class="flex-w flex-sb-m p-t-26 p-b-30">
					<span class="m-text22 w-size19 w-full-sm">
						Total:
					</span>

					<span class="m-text21 w-size20 w-full-sm" id="total_with_shipping">
						
					</span>
				</div>

				<form action="invoice.html" method="POST" onsubmit = change_success() >
						<script
						  src="https://checkout.stripe.com/checkout.js" class="stripe-button"
						  data-key="pk_test_OQCRdigC0WDmT4zh63DpNQEh00Mg9gLiVm"
						  data-amount= ""	
						  data-name="Fashe"
						  data-description="O$P$"
						  data-image="images/icons/yilong.png"
                          data-locale="auto">
                          
                          
						</script>
					  </form>
			</div>
		</div>
	</section>




	<!-- Back to top -->
	<div class="btn-back-to-top bg0-hov" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="fa fa-angle-double-up" aria-hidden="true"></i>
		</span>
	</div>

	<!-- Container Selection -->
	<div id="dropDownSelect1"></div>
	<div id="dropDownSelect2"></div>



<!--===============================================================================================-->
	<script type="text/javascript" src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="vendor/jquery/jquery.cookie.js"></script>
<!--===============================================================================================-->
	<script type="text/javascript" src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script type="text/javascript" src="vendor/bootstrap/js/popper.js"></script>
	<script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script type="text/javascript" src="vendor/select2/select2.min.js"></script>
	<script type="text/javascript">
		$(".selection-1").select2({
			minimumResultsForSearch: 20,
			dropdownParent: $('#dropDownSelect1')
		});

		$(".selection-2").select2({
			minimumResultsForSearch: 20,
			dropdownParent: $('#dropDownSelect2')
		});
	</script>


<!--===============================================================================================-->
	<script src="js/main.js"></script>

	<script>
		function loadAllFunctions() {
			
			loadCart();
            loadHeader();
            load_shipping();
            load_final_price();
			loadId();
            
		}
	
	
	</script>

<script> 
		function loadHeader() {

			window.total_price = 0; //define variable total_price to calculate total bill
			var item_total = 0; //define variable item_total to calculate total price for that item
			let output = document.querySelector(".insert-header");

			//for(var n =0 ; n < cart.length; n ++) {

					 var item_price = cart.new_price;
					 var int_price = Number(item_price.replace(/[^0-9.-]+/g,""));

					item_total = int_price * 1; //item_price = price of item * quantity of items bought by customer
					total_price += item_total;

					output.innerHTML += 
				
					`<div class="header-cart-item-img">
						<img src="${cart.image_url}" alt="IMG">
					</div>

					<div class="header-cart-item-txt">
						<a href="#" class="header-cart-item-name">
							${cart.product_name}
						</a>

						<span class="header-cart-item-info">
							1 x ${cart.new_price}
						</span>
					</div>`

					
					item_total = 0;
		//	}
		total_price = Number(total_price).toFixed(2);
		document.querySelector("#total_price").innerHTML = "Total Price: $" + total_price	;
		document.getElementById("subtotal").innerHTML = "Subtotal: $" + sessionStorage.getItem("total_total_price");

		}
		</script>	

<script>
		function loadCart() {
		
						var total_price = 0; //define variable total_price to calculate total bill
						var item_total = 0; //define variable item_total to calculate total price for that item
						let output = document.querySelector(".insert-item");
						let quantity = sessionStorage.getItem("quantity");
						//for(var i =0 ; i < cart.length; i ++) {
		
								item_price = cart.new_price; 
								var int_price = Number(item_price.replace(/[^0-9.-]+/g,""));
								item_total = int_price * 1; //item_price = price of item * quantity of items bought by customer
								item_total = Number(item_total).toFixed(2);
								total_price += int_price;

								let total_total_price = sessionStorage.getItem("total_total_price");
							
								output.innerHTML += 
							
									`<td class="column-1">
										<div class="cart-img-product b-rad-4 o-f-hidden">
											<img src=${cart.image_url} alt="IMG-PRODUCT">
										</div>
									</td>
									<td class="column-2">${cart.product_name}</td>
									<td class="column-3">${cart.new_price}</td>
									<td class="column-4">
										<div class="flex-w bo5 of-hidden w-size11">
											
		
											<input class="size8 m-text18 t-center num-product" type="number" name="num-product1" readonly value=${quantity}>
		
											
										</div>
									</td>
									<td class="column-5">$${total_total_price}</td>`
		
								item_total = 0; //resets item_price 
								
								total_price = Number(total_price).toFixed(2);
								sessionStorage.setItem("total_price", total_price);
		
							//}
				
			}
</script>

<script>
                    
        function load_shipping(){
            let country = sessionStorage.getItem("country");
            let postal = sessionStorage.getItem("postal");
            let output = document.querySelector(".select_shipping");

            var request = new XMLHttpRequest();

            request.open('POST', 'https://api.easyship.com/rate/v1/rates');

            request.setRequestHeader('Content-Type', 'application/json');
            request.setRequestHeader('Authorization', 'Bearer prod_4dHdKJmXwRVlJwfzSrXwbq8oKLLX3hsU3P4/seNF8n0=');

            request.onreadystatechange = function () {

            if (this.readyState === 4) {

                var data = JSON.parse(this.responseText);

                var rates = data.rates;
                //sessionStorage.setItem("rates", rates);
                for (i=0; i<rates.length; i++){
                    sessionStorage.setItem(`rates${i}`,rates[i].shipment_charge)
                    output.innerHTML +=

                    `<option value=${i}>${rates[i].courier_name} (+$${Number(rates[i].shipment_charge).toFixed(2)})</option>`
                    console.log(rates[i])
                    console.log(rates[i].shipment_charge)
                }


                }


            };

            var body = {
            'origin_country_alpha2': country,
            'origin_postal_code': '178902',
            'destination_country_alpha2': country,
            'destination_postal_code': postal,
            'taxes_duties_paid_by': 'Sender',
            'is_insured': false,
            'items': [
            {
            'actual_weight': 1.2,
            'height': 10,
            'width': 15,
            'length': 20,
            'category': 'mobiles',
            'declared_currency': 'SGD',
            'declared_customs_value': 100
            }
            ]
            };

            request.send(JSON.stringify(body));    
        }
</script>

<script>
    function get_price(){
        var i = document.getElementById("ship").value;
        console.log(ship);
        let shipping_price = sessionStorage.getItem(`rates${i}`);
        shipping_price = parseFloat(shipping_price);
        console.log(shipping_price)
        var total_price = sessionStorage.getItem("total_total_price");
        total_price = parseFloat(total_price)
        var final_price = shipping_price + total_price;
        final_price = Number(final_price).toFixed(2);
		sessionStorage.setItem("final_price", final_price);
        //sessionStorage.setItem("final_price", final_price);

        document.querySelector("#total_with_shipping").innerHTML = "$" + final_price;
    }
	var subButton = document.getElementById('submit');  
	subButton.addEventListener('click', get_price, false);

	
    
	//function change_success(){
//
	//	var index = sessionStorage.getItem("index");
	//	index += 1;
	//	sessionStorage.setItem("index") = index; 
	//	var payment_success = "success";
	//	sessionStorage.setItem("payment_success", payment_success);
//
	//	//alert("Your order has been placed! We will notify you if your groupbuy is successful!");
	//}
   
	function loadId() {
		console.log("HI");
    let id = sessionStorage.getItem("id");
    document.querySelector(".topbar-id").innerHTML = id;
    console.log(id);

      }

</script>

</body>
</html>
